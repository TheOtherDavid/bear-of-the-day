name: Build and Deploy Vue.js App

on:
    push:
        branches:
            - main

jobs:
    build-deploy:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout code
          uses: actions/checkout@v2

        - name: Set up Node.js
          uses: actions/setup-node@v2
          with:
                node-version: 14

        - name: Install dependencies
          run: npm ci

        - name: Build
          run: npm run build

        - name: Deploy to AWS Amplify
          uses: aws-actions/amplify-console-deployment@master
          with:
            amplifyAppId: ${{ secrets.AMPLIFY_APP_ID }}
            branch: main
            buildSpecContent: |
                version: 1
                frontend:
                    phases:
                        preBuild:
                            commands:
                                - npm ci
                        build:
                            commands:
                                - npm run build
                    artifacts:
                        baseDirectory: dist
                        files:
                            - '**/*'
                    cache:
                        paths:
                            - node_modules/**/*